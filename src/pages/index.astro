---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import About from '../components/About.astro';
import Skills from '../components/Skills.astro';
import Contact from '../components/Contact.astro';
import Projects from '../components/Projects.astro';
import Experience from '../components/Experience.astro';
import Education from '../components/Education.astro';
import Certifications from '../components/Certifications.astro';
import Welcome from '../components/Welcome.astro';

export const prerender = true;
---

<Layout>
	<div class="min-h-screen bg-[#16161e] overflow-hidden flex items-center justify-center p-2 sm:p-4">
		<div class="terminal-container w-full max-w-6xl shadow-2xl border border-[#7aa2f7]/20 rounded overflow-hidden flex flex-col">
			<!-- Terminal Header -->
			<div class="terminal-title-bar shrink-0 flex justify-between items-center">
				<div class="terminal-buttons flex gap-2">
					<button id="btn-close" class="terminal-button bg-[#f7768e] hover:bg-[#db4b4b] transition-colors" aria-label="Close"></button>
					<button id="btn-minimize" class="terminal-button bg-[#e0af68] hover:bg-[#c09040] transition-colors" aria-label="Minimize"></button>
					<button id="btn-maximize" class="terminal-button bg-[#9ece6a] hover:bg-[#78ac3e] transition-colors" aria-label="Maximize"></button>
				</div>
				<div class="terminal-title absolute left-1/2 -translate-x-1/2 text-[#c0caf5] text-xs font-medium opacity-80">guest@dfanso.dev:~</div>
				<div class="terminal-time text-[#565f89] text-xs font-mono" id="header-time">--:--</div>
			</div>

			<!-- Terminal Content -->
			<div id="terminal" class="terminal-content-area flex-1 relative" onclick="document.getElementById('terminal-input').focus()">
				<div id="output-container">
					<!-- Welcome message -->
					<div class="command-block">
						<div class="command-prompt"><span class="text-[#9ece6a]">‚ùØ</span> <span class="text-[#7aa2f7]">dfanso</span><span class="text-[#565f89]">@</span><span class="text-[#bb9af7]">terminal</span> <span class="text-[#565f89]">in</span> <span class="text-[#e0af68]">~/portfolio</span> <span class="text-[#565f89]">on</span> <span class="text-[#f7768e]">main</span></div>
						<div class="command-output"><Welcome /></div>
					</div>

					<!-- Whoami command -->
					<div class="command-block">
						<div class="command-prompt"><span class="text-[#9ece6a]">‚ùØ</span> <span class="text-[#7aa2f7]">dfanso</span><span class="text-[#565f89]">@</span><span class="text-[#bb9af7]">terminal</span> <span class="text-[#565f89]">in</span> <span class="text-[#e0af68]">~/portfolio</span> <span class="text-[#565f89]">on</span> <span class="text-[#f7768e]">main</span></div>
						<div class="command-output"><Header /></div>
					</div>
				</div>

				<!-- Command Input -->
				<div class="command-block" id="input-line">
					<div class="command-prompt">
						<span class="text-[#9ece6a]">‚ùØ</span> <span class="text-[#7aa2f7]">dfanso</span><span class="text-[#565f89]">@</span><span class="text-[#bb9af7]">terminal</span> <span class="text-[#565f89]">in</span> <span class="text-[#e0af68]">~/portfolio</span> <span class="text-[#565f89]">on</span> <span class="text-[#f7768e]">main</span> 
						<span class="command-text"></span><span class="cursor"></span>
						<input type="text" id="terminal-input" class="opacity-0 absolute top-0 left-0 h-full w-full cursor-text" autocomplete="off" spellcheck="false" />
					</div>
				</div>
			</div>

			<!-- Terminal Footer -->
			<div class="terminal-footer shrink-0 p-2 text-center bg-[#1a1b26] border-t border-[#7aa2f7]/10">
				<p class="text-[10px] sm:text-xs text-[#7aa2f7]">Made with <span class="text-[#f7768e]">‚ù§</span> by DFanso</p>
			</div>

			<!-- Hidden Components -->
			<div id="components" class="hidden">
				<div id="welcome"><Welcome /></div>
				<div id="whoami"><Header /></div>
				<div id="about"><About /></div>
				<div id="projects"><Projects /></div>
				<div id="skills"><Skills /></div>
				<div id="experience"><Experience /></div>
				<div id="education"><Education /></div>
				<div id="certifications"><Certifications /></div>
				<div id="contact"><Contact /></div>
				<div id="ls">
					<div class="command-output">
						<div class="text-[#bb9af7] font-bold mb-2">Directory listing of ~/portfolio</div>
						<div class="space-y-1">
							<div class="flex items-center gap-2">
								<span class="text-[#565f89]">drwxr-xr-x</span>
								<span class="text-[#7aa2f7]">about/</span>
								<span class="text-[#565f89] ml-auto">professional summary</span>
							</div>
							<div class="flex items-center gap-2">
								<span class="text-[#565f89]">drwxr-xr-x</span>
								<span class="text-[#7aa2f7]">projects/</span>
								<span class="text-[#565f89] ml-auto">featured work</span>
							</div>
							<div class="flex items-center gap-2">
								<span class="text-[#565f89]">drwxr-xr-x</span>
								<span class="text-[#7aa2f7]">skills/</span>
								<span class="text-[#565f89] ml-auto">technical expertise</span>
							</div>
							<div class="flex items-center gap-2">
								<span class="text-[#565f89]">drwxr-xr-x</span>
								<span class="text-[#7aa2f7]">experience/</span>
								<span class="text-[#565f89] ml-auto">work history</span>
							</div>
							<div class="flex items-center gap-2">
								<span class="text-[#565f89]">drwxr-xr-x</span>
								<span class="text-[#7aa2f7]">education/</span>
								<span class="text-[#565f89] ml-auto">academic background</span>
							</div>
							<div class="flex items-center gap-2">
								<span class="text-[#565f89]">drwxr-xr-x</span>
								<span class="text-[#7aa2f7]">certifications/</span>
								<span class="text-[#565f89] ml-auto">licenses & certs</span>
							</div>
							<div class="flex items-center gap-2">
								<span class="text-[#565f89]">drwxr-xr-x</span>
								<span class="text-[#7aa2f7]">contact/</span>
								<span class="text-[#565f89] ml-auto">social links</span>
							</div>
							<div class="flex items-center gap-2">
								<span class="text-[#565f89]">-rw-r--r--</span>
								<span class="text-[#e0af68]">welcome.txt</span>
								<span class="text-[#565f89] ml-auto">welcome message</span>
							</div>
							<div class="flex items-center gap-2">
								<span class="text-[#565f89]">-rw-r--r--</span>
								<span class="text-[#e0af68]">whoami.txt</span>
								<span class="text-[#565f89] ml-auto">profile info</span>
							</div>
							<div class="flex items-center gap-2">
								<span class="text-[#565f89]">-rw-r--r--</span>
								<span class="text-[#e0af68]">resume.pdf</span>
								<span class="text-[#565f89] ml-auto">curriculum vitae</span>
							</div>
						</div>
						<div class="text-[#565f89] text-xs mt-4">
							Use 'cd' to navigate or type the command directly (e.g., 'about', 'projects')
						</div>
					</div>
				</div>
				<div id="neofetch">
					<div class="command-output">
						<div class="flex flex-col sm:flex-row gap-6">
							<pre class="text-[#7aa2f7] text-[8px] sm:text-base leading-none sm:leading-normal">
                  ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ
                ‚ñÑ‚ñÄ‚ñà‚ñÄ‚ñà‚ñÄ‚ñà‚ñÄ‚ñà‚ñÄ‚ñà‚ñÄ‚ñà‚ñÄ‚ñÑ
               ‚ñà‚ñÄ‚ñà‚ñÄ‚ñà‚ñÄ‚ñà‚ñÄ‚ñà‚ñÄ‚ñà‚ñÄ‚ñà‚ñÄ‚ñà‚ñÄ‚ñà
              ‚ñÑ‚ñà‚ñÄ‚ñà‚ñÄ‚ñà‚ñÄ‚ñà‚ñÄ‚ñà‚ñÄ‚ñà‚ñÄ‚ñà‚ñÄ‚ñà‚ñÄ‚ñà‚ñÑ
             ‚ñÄ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÄ
			</pre>
							<div class="space-y-1">
								<div class="flex gap-2">
									<span class="text-[#7aa2f7]">OS:</span>
									<span class="text-[#c0caf5]">Portfolio v2.4.2</span>
								</div>
								<div class="flex gap-2">
									<span class="text-[#7aa2f7]">Host:</span>

									<span class="text-[#c0caf5]">dfanso.dev</span>
								</div>
								<div class="flex gap-2">
									<span class="text-[#7aa2f7]">Kernel:</span>
									<span class="text-[#c0caf5]">DevOps 5.0.1</span>
								</div>
								<div class="flex gap-2">
									<span class="text-[#7aa2f7]">Uptime:</span>
									<span class="text-[#c0caf5]">24/7</span>
								</div>
								<div class="flex gap-2">
									<span class="text-[#7aa2f7]">Shell:</span>
									<span class="text-[#c0caf5]">Portfolio-CLI</span>
								</div>
								<div class="flex gap-2">
									<span class="text-[#7aa2f7]">IDE:</span>
									<span class="text-[#c0caf5]">VS Code / Neovim</span>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div id="time">
					<div class="command-output">
						<div class="text-[#9ece6a]" id="current-time"></div>
					</div>
				</div>
				<div id="weather">
					<div class="command-output">
						<div class="text-[#7aa2f7]">Weather information is not available in the terminal.</div>
						<div class="text-[#565f89]">Try looking outside your window! üå§Ô∏è</div>
					</div>
				</div>
				<div id="matrix">
					<div class="command-output matrix-animation">
						<pre class="text-[#9ece6a]">
Digital rain simulation...
‚ñà ‚ñà ‚ñà ‚ñà ‚ñà ‚ñà ‚ñà ‚ñà ‚ñà ‚ñà
 ‚ñà ‚ñà ‚ñà ‚ñà ‚ñà ‚ñà ‚ñà ‚ñà ‚ñà
‚ñà ‚ñà ‚ñà ‚ñà ‚ñà ‚ñà ‚ñà ‚ñà ‚ñà ‚ñà
 ‚ñà ‚ñà ‚ñà ‚ñà ‚ñà ‚ñà ‚ñà ‚ñà ‚ñà</pre>
					</div>
				</div>
				<div id="ping">
					<div class="command-output ping-animation">
						<div class="text-[#bb9af7] font-bold mb-2">PING dfanso.dev (192.168.1.1)</div>
						<div class="space-y-1 font-mono">
							<div class="ping-line">
								<span class="text-[#7aa2f7]">64 bytes from dfanso.dev</span>
								<span class="text-[#565f89]">: icmp_seq=1 ttl=64 time=</span>
								<span class="text-[#9ece6a]">0.045 ms</span>
							</div>
							<div class="ping-line">
								<span class="text-[#7aa2f7]">64 bytes from dfanso.dev</span>
								<span class="text-[#565f89]">: icmp_seq=2 ttl=64 time=</span>
								<span class="text-[#9ece6a]">0.038 ms</span>
							</div>
							<div class="ping-line">
								<span class="text-[#7aa2f7]">64 bytes from dfanso.dev</span>
								<span class="text-[#565f89]">: icmp_seq=3 ttl=64 time=</span>
								<span class="text-[#9ece6a]">0.042 ms</span>
							</div>
							<div class="ping-line">
								<span class="text-[#7aa2f7]">64 bytes from dfanso.dev</span>
								<span class="text-[#565f89]">: icmp_seq=4 ttl=64 time=</span>
								<span class="text-[#9ece6a]">0.039 ms</span>
							</div>
						</div>
						<div class="mt-4 text-[#c0caf5]">
							<span class="text-[#565f89]">---</span> dfanso.dev ping statistics <span class="text-[#565f89]">---</span><br>
							4 packets transmitted, 4 received, 0% packet loss, time 3ms<br>
							rtt min/avg/max = 0.038/0.041/0.045 ms
						</div>
					</div>
				</div>
				<div id="help">
					<div class="command-list">
						<p class="text-[#bb9af7] font-bold mb-4">Terminal Portfolio Help</p>
						<div class="mb-4">
							<p class="text-[#7aa2f7] mb-2">USAGE:</p>
							<p class="text-[#c0caf5] ml-4">command [arguments]</p>
						</div>
						<div class="mb-4">
							<p class="text-[#7aa2f7] mb-2">AVAILABLE COMMANDS:</p>
							<ul class="command-help-list">
								<li>
									<div class="command-name">ls</div>
									<div class="command-desc">List available sections and commands</div>
								</li>
								<li>
									<div class="command-name">welcome</div>
									<div class="command-desc">Display welcome message and ASCII art</div>
								</li>
								<li>
									<div class="command-name">whoami</div>
									<div class="command-desc">Show detailed profile information</div>
								</li>
								<li>
									<div class="command-name">about</div>
									<div class="command-desc">View my professional summary</div>
								</li>
								<li>
									<div class="command-name">projects</div>
									<div class="command-desc">Browse my featured projects</div>
								</li>
								<li>
									<div class="command-name">skills</div>
									<div class="command-desc">List technical skills and expertise</div>
								</li>
								<li>
									<div class="command-name">experience</div>
									<div class="command-desc">View work history and roles</div>
								</li>
								<li>
									<div class="command-name">education</div>
									<div class="command-desc">View academic background</div>
								</li>
								<li>
									<div class="command-name">certifications</div>
									<div class="command-desc">View professional certificates</div>
								</li>
								<li>
									<div class="command-name">contact</div>
									<div class="command-desc">Get my contact information</div>
								</li>
								<li>
									<div class="command-name">clear</div>
									<div class="command-desc">Clear terminal screen</div>
								</li>
								<li>
									<div class="command-name">help</div>
									<div class="command-desc">Show this help message</div>
								</li>
								<li>
									<div class="command-name">neofetch</div>
									<div class="command-desc">Display system information</div>
								</li>
								<li>
									<div class="command-name">time</div>
									<div class="command-desc">Show current time</div>
								</li>
								<li>
									<div class="command-name">weather</div>
									<div class="command-desc">Check the weather (sort of)</div>
								</li>
								<li>
									<div class="command-name">matrix</div>
									<div class="command-desc">Display the matrix animation</div>
								</li>
								<li>
									<div class="command-name">ping</div>
									<div class="command-desc">Test connection to dfanso.dev</div>
								</li>
							</ul>
						</div>
						<div class="text-[#565f89] text-xs mt-6">
							<p>Use arrow keys ‚Üë‚Üì to navigate command history</p>
							<p>Press Ctrl+L or type 'clear' to clear screen</p>
						</div>
					</div>
				</div>
			</div>
		</div>
	<!-- Shutdown Screen -->
	<div id="shutdown-screen" class="fixed inset-0 z-50 hidden bg-[#16161e] flex-col items-center justify-center text-center p-4">
		<div class="text-[#f7768e] font-bold text-xl mb-4">System Halted</div>
		<div class="text-[#565f89] mb-8">It is now safe to turn off your computer.</div>
		<button id="btn-reboot" class="px-6 py-2 border border-[#7aa2f7] text-[#7aa2f7] hover:bg-[#7aa2f7]/10 rounded transition-colors font-mono">
			REBOOT SYSTEM
		</button>
	</div>
</Layout>

<script>
	const body = document.body;
	body.classList.remove('no-js');
	body.classList.add('booting');

	class Terminal {
		private terminal: HTMLElement;
		private outputContainer: HTMLElement;
		private inputLine: HTMLElement;
		private inputField: HTMLInputElement;
		private currentInput: string = '';
		private commandHistory: string[] = [];
		private historyIndex: number = -1;
		private awaitingProjectResponse: boolean = false;
		private availableCommands: string[] = [
			'help', 'whoami', 'about', 'projects', 'skills', 
			'experience', 'education', 'certifications', 'contact', 'clear', 'ls', 'neofetch', 
			'time', 'weather', 'matrix', 'ping', 'welcome',
			'resume', 'sudo', 'rm', 'vi', 'vim', 'nano'
		];
		private suggestionsContainer: HTMLElement | null = null;
		private idleTimeout?: number;
		private idleDelay = 7000;
		private highlightPatterns = [
			{ regex: /(error|failed|failure|oops)/gi, className: 'syntax-error' },
			{ regex: /(success|ready|completed|done|online)/gi, className: 'syntax-success' },
			{ regex: /(warning|caution)/gi, className: 'syntax-warning' },
			{ regex: /(https?:\/\/[^\s<]+)/gi, className: 'syntax-link' },
			{ regex: /(--?[a-z0-9\-]+)/gi, className: 'syntax-flag' },
			{ regex: /(~\/[a-z0-9_\-\/]+)/gi, className: 'syntax-path' },
			{ regex: /\b(ls|cat|touch|mkdir|ping|curl|grep|git)\b/gi, className: 'syntax-command' }
		];
		private resetIdleTimer = () => {
			document.body.classList.remove('terminal-idle');
			if (this.idleTimeout) {
				window.clearTimeout(this.idleTimeout);
			}
			this.idleTimeout = window.setTimeout(() => {
				document.body.classList.add('terminal-idle');
			}, this.idleDelay);
		};


		constructor() {
			this.terminal = document.getElementById('terminal') as HTMLElement;
			this.outputContainer = document.getElementById('output-container') as HTMLElement;
			this.inputLine = document.getElementById('input-line') as HTMLElement;
			this.inputField = document.getElementById('terminal-input') as HTMLInputElement;
			this.initializeTerminal();
			this.initializeClipboard();
			this.createSuggestionsContainer();
			this.attachGlobalIdleListeners();
			this.resetIdleTimer();
			this.initializeWindowControls();
		}

		private initializeWindowControls(): void {
			const container = document.querySelector('.terminal-container');
			const btnClose = document.getElementById('btn-close');
			const btnMinimize = document.getElementById('btn-minimize');
			const btnMaximize = document.getElementById('btn-maximize');
			const shutdownScreen = document.getElementById('shutdown-screen');
			const btnReboot = document.getElementById('btn-reboot');

			// Close / Reboot Logic
			btnClose?.addEventListener('click', () => {
				container?.classList.add('opacity-0', 'scale-95');
				setTimeout(() => {
					shutdownScreen?.classList.remove('hidden');
					shutdownScreen?.classList.add('flex');
				}, 300);
			});

			btnReboot?.addEventListener('click', () => {
				shutdownScreen?.classList.add('hidden');
				shutdownScreen?.classList.remove('flex');
				container?.classList.remove('opacity-0', 'scale-95');
				this.outputContainer.innerHTML = '';
				const inputLine = document.getElementById('input-line');
				if (inputLine) {
					inputLine.innerHTML = `
						<div class="command-prompt">
							<span class="text-[#9ece6a]">‚ùØ</span> <span class="text-[#7aa2f7]">dfanso</span><span class="text-[#565f89]">@</span><span class="text-[#bb9af7]">terminal</span> <span class="text-[#565f89]">in</span> <span class="text-[#e0af68]">~/portfolio</span> <span class="text-[#565f89]">on</span> <span class="text-[#f7768e]">main</span> 
							<span class="command-text"></span><span class="cursor"></span>
							<input type="text" id="terminal-input" class="opacity-0 absolute top-0 left-0 h-full w-full cursor-text" autocomplete="off" spellcheck="false" />
						</div>
					`;
					// Re-attach input listener to new input element
					this.inputField = document.getElementById('terminal-input') as HTMLInputElement;
					this.inputLine = document.getElementById('input-line') as HTMLElement;
					this.initializeTerminal(); 
				}
				this.executeCommand('welcome', document.createElement('div'));
				setTimeout(() => this.executeCommand('whoami', document.createElement('div')), 500);
			});

			// Maximize Logic
			btnMaximize?.addEventListener('click', () => {
				container?.classList.toggle('max-w-6xl');
				container?.classList.toggle('w-full');
				container?.classList.toggle('h-full');
				container?.classList.toggle('max-w-full');
				container?.classList.toggle('rounded-none');
				container?.classList.toggle('m-0');
			});
			
			// Minimize Logic (Just a visual feedback for now)
			btnMinimize?.addEventListener('click', () => {
				container?.classList.add('translate-y-4', 'opacity-80');
				setTimeout(() => {
					container?.classList.remove('translate-y-4', 'opacity-80');
				}, 200);
			});
		}

		private createSuggestionsContainer(): void {
			this.suggestionsContainer = document.createElement('div');
			this.suggestionsContainer.className = 'suggestions-container hidden';
			this.terminal.appendChild(this.suggestionsContainer);
		}

		private showSuggestions(input: string): void {
			if (!this.suggestionsContainer) return;

			if (!input) {
				this.suggestionsContainer.classList.add('hidden');
				return;
			}

			const suggestions = this.availableCommands.filter(cmd => 
				cmd.startsWith(input.toLowerCase()) && cmd !== input.toLowerCase()
			);

			if (suggestions.length === 0) {
				this.suggestionsContainer.classList.add('hidden');
				return;
			}

			this.suggestionsContainer.innerHTML = suggestions
				.map(s => {
					const matchedPart = s.substring(0, input.length);
					const remainingPart = s.substring(input.length);
					return `<div class="suggestion-item" data-command="${s}">
						<span class="matched-text">${matchedPart}</span><span class="remaining-text">${remainingPart}</span>
					</div>`;
				})
				.join('');

			this.suggestionsContainer.classList.remove('hidden');

			// Position suggestions below current input
			const inputRect = this.inputLine.getBoundingClientRect();
			const terminalRect = this.terminal.getBoundingClientRect();
			this.suggestionsContainer.style.top = `${inputRect.bottom - terminalRect.top}px`;
			this.suggestionsContainer.style.left = `${inputRect.left - terminalRect.left}px`;

			// Add click handlers for suggestions
			this.suggestionsContainer.querySelectorAll('.suggestion-item').forEach(item => {
				item.addEventListener('click', () => {
					this.currentInput = (item as HTMLElement).dataset.command || '';
					this.inputField.value = this.currentInput;
					this.updateInputLine();
					this.suggestionsContainer?.classList.add('hidden');
					this.inputField.focus();
				});
			});
		}

		private initializeTerminal(): void {
			// Focus input on click anywhere in terminal
			this.terminal.addEventListener('click', (e) => {
				const target = e.target as HTMLElement;
				if (!target.closest('.suggestions-container') && !target.closest('a')) {
					this.suggestionsContainer?.classList.add('hidden');
					this.inputField.focus();
				}
				this.resetIdleTimer();
			});

			// Handle input changes
			this.inputField.addEventListener('input', (e) => {
				const target = e.target as HTMLInputElement;
				this.currentInput = target.value;
				this.updateInputLine();
				this.showSuggestions(this.currentInput);
				this.resetIdleTimer();
			});

			this.inputField.addEventListener('keydown', (e: KeyboardEvent) => {
				this.resetIdleTimer();
				// Handle Tab completion
				if (e.key === 'Tab') {
					e.preventDefault();
					this.handleTabCompletion();
					return;
				}

				// Handle Ctrl+L to clear
				if ((e.ctrlKey || e.metaKey) && e.key === 'l') {
					this.outputContainer.innerHTML = '';
					e.preventDefault();
					return;
				}

				// Handle Enter
				if (e.key === 'Enter') {
					this.suggestionsContainer?.classList.add('hidden');
					this.handleEnter();
				} 
				// Handle Arrow Up/Down for history
				else if (e.key === 'ArrowUp') {
					this.handleArrowUp();
					e.preventDefault();
				} else if (e.key === 'ArrowDown') {
					this.handleArrowDown();
					e.preventDefault();
				}
			});
			
			// Initial focus
			this.inputField.focus();
		}

		private attachGlobalIdleListeners(): void {
			window.addEventListener('mousemove', this.resetIdleTimer);
			window.addEventListener('touchstart', this.resetIdleTimer, { passive: true });
			window.addEventListener('keydown', this.resetIdleTimer);
		}

		private handleTabCompletion(): void {
			const suggestions = this.availableCommands.filter(cmd => 
				cmd.startsWith(this.currentInput.toLowerCase())
			);

			if (suggestions.length === 1) {
				this.currentInput = suggestions[0];
				this.inputField.value = this.currentInput;
				this.updateInputLine();
				this.suggestionsContainer?.classList.add('hidden');
			} else if (suggestions.length > 1) {
				this.showSuggestions(this.currentInput);
			}
		}

		private initializeClipboard(): void {
			// Add copy button to command outputs only
			this.terminal.addEventListener('mouseup', () => {
				const selection = window.getSelection()?.toString();
				if (selection) {
					this.showCopyButton(selection);
				} else {
					this.hideCopyButton();
				}
				this.resetIdleTimer();
			});
		}

		private handleCopy(e: KeyboardEvent): void {
			// Native copy works fine with input field
		}

		private handlePaste(e: KeyboardEvent): void {
			// Native paste works fine with input field
		}

		private showCopyButton(text: string): void {
			let copyButton = document.getElementById('copy-button');
			if (!copyButton) {
				copyButton = document.createElement('button');
				copyButton.id = 'copy-button';
				copyButton.className = 'copy-button';
				copyButton.innerHTML = 'üìã';
				document.body.appendChild(copyButton);

				copyButton.addEventListener('click', () => {
					navigator.clipboard.writeText(text).then(() => {
						this.showCopyFeedback();
					});
				});
			}

			const selection = window.getSelection();
			if (selection && selection.rangeCount > 0) {
				const range = selection.getRangeAt(0);
				const rect = range.getBoundingClientRect();
				copyButton.style.top = `${rect.top - 30}px`;
				copyButton.style.left = `${rect.right}px`;
				copyButton.style.display = 'block';
			}
		}

		private hideCopyButton(): void {
			const copyButton = document.getElementById('copy-button');
			if (copyButton) {
				copyButton.style.display = 'none';
			}
		}

		private showCopyFeedback(): void {
			const feedback = document.createElement('div');
			feedback.className = 'copy-feedback';
			feedback.textContent = 'Copied! üìã';
			document.body.appendChild(feedback);

			setTimeout(() => {
				feedback.remove();
			}, 1500);
		}

		private handleEnter(): void {
			const command = this.currentInput.trim().toLowerCase();
			
			// Clone current input line without cursor and input
			const inputClone = this.inputLine.cloneNode(true) as HTMLElement;
			inputClone.removeAttribute('id');
			const commandText = inputClone.querySelector('.command-text');
			if (commandText) {
				commandText.textContent = this.currentInput;
			}
			const cursor = inputClone.querySelector('.cursor');
			if (cursor) {
				cursor.remove();
			}
			const input = inputClone.querySelector('input');
			if (input) {
				input.remove();
			}

			// Add command output
			const outputDiv = document.createElement('div');
			outputDiv.className = 'command-output';
			inputClone.appendChild(outputDiv);

			if (!command) {
				// Handle empty input with random messages
				const emptyMessages = [
					"ü§î Hmm... trying to say something?",
					"üí≠ The silence is deafening...",
					"‚å®Ô∏è The keyboard is waiting for your command!",
					"‚ú® Type 'help' if you're not sure what to do",
					"üåü Press some keys, then press Enter!",
					"üéØ Almost there! Just need to type a command first",
					"üöÄ Ready for your input, commander!"
				];
				const randomMessage = emptyMessages[Math.floor(Math.random() * emptyMessages.length)];
				this.renderOutputHTML(outputDiv, `<div class="text-[#bb9af7]">${randomMessage}</div>`);
				this.outputContainer.appendChild(inputClone);
			} else {
				// Add to history only if command is not empty
				this.commandHistory.push(command);
				this.historyIndex = this.commandHistory.length;

				// Execute command
				this.executeCommand(command, outputDiv);

				// Add to output container
				this.outputContainer.appendChild(inputClone);
			}

			// Reset input
			this.currentInput = '';
			this.inputField.value = '';
			this.updateInputLine();
			this.terminal.scrollTop = this.terminal.scrollHeight;
			this.resetIdleTimer();
		}

		private executeCommand(command: string, outputDiv: HTMLElement): void {
			const args = command.split(' ');
			const cmd = args[0];
			const arg = args[1];

			if (cmd === 'clear') {
				this.outputContainer.innerHTML = '';
				return;
			}

			if (cmd === 'resume') {
				this.renderOutputHTML(outputDiv, `<div class="command-output">
					<p class="text-[#c0caf5] mb-2">Opening resume...</p>
					<p class="text-[#565f89] text-xs">(If it doesn't open, <a href="/resume.pdf" target="_blank" class="text-[#7aa2f7] underline">click here</a>)</p>
				</div>`);
				window.open('/resume.pdf', '_blank');
				return;
			}

			if (command === 'sudo') {
				this.renderOutputHTML(outputDiv, `<div class="command-output text-[#f7768e]">Permission denied: You are not in the sudoers file. This incident will be reported to Santa Claus. üéÖ</div>`);
				return;
			}

			if (command.startsWith('rm')) {
				if (command.includes('-rf') && (command.includes('/') || command.includes('*'))) {
					this.renderOutputHTML(outputDiv, `<div class="command-output text-[#f7768e] font-bold">‚ö†Ô∏è CRITICAL ERROR: Nice try! But I can't let you delete my portfolio.</div>`);
				} else {
					this.renderOutputHTML(outputDiv, `<div class="command-output text-[#f7768e]">rm: missing operand</div>`);
				}
				return;
			}

			if (['vi', 'vim', 'nano'].includes(command)) {
				this.renderOutputHTML(outputDiv, `<div class="command-output text-[#e0af68]">Error: Text editor functionality not implemented yet. Try 'code .' instead? üòâ</div>`);
				return;
			}

			// Handle interactive project response
			if (this.awaitingProjectResponse) {
				const response = command.toLowerCase();
				if (response === 'y' || response === 'yes') {
					this.renderOutputHTML(outputDiv, `<div class="text-[#9ece6a] command-output">
						<p class="mb-2">üîó Check out more of my projects:</p>
						<a href="https://github.com/dfanso" target="_blank" class="text-[#7aa2f7] hover:text-[#9ece6a] transition-colors">
							<span class="text-[#565f89]">‚îî‚îÄ‚ñ∂</span> Visit my GitHub Profile
						</a>
					</div>`);
				} else if (response === 'n' || response === 'no') {
					this.renderOutputHTML(outputDiv, '<div class="text-[#9ece6a] command-output"><span class="text-[#565f89]">‚îî‚îÄ‚ñ∂</span> Alright! Feel free to explore other commands using `help`.</div>');
				} else {
					this.renderOutputHTML(outputDiv, '<div class="text-[#f7768e] command-output"><span class="text-[#565f89]">‚îî‚îÄ‚ñ∂</span> Please answer with y/n.</div>');
					this.awaitingProjectResponse = true;
					return;
				}
				this.awaitingProjectResponse = false;
				return;
			}

			const componentId = command === 'whoami' ? 'whoami' : command;
			const component = document.getElementById(componentId);

			if (component) {
				this.renderOutputHTML(outputDiv, component.innerHTML);
				
				// Add interactive project prompt if it's the projects command
				if (command === 'projects') {
					const promptDiv = document.createElement('div');
					promptDiv.className = 'mt-4 text-[#9ece6a] command-prompt';
					promptDiv.innerHTML = '<span class="text-[#9ece6a]">‚ùØ</span> Would you like to see more projects? (y/n)';
					outputDiv.appendChild(promptDiv);
					this.applySyntaxHighlight(promptDiv as HTMLElement);
					this.animateOutput(promptDiv as HTMLElement);
					
					// Set a flag to handle the next input differently
					this.awaitingProjectResponse = true;
				}
			} else {
				this.renderOutputHTML(outputDiv, `<div class="text-[#f7768e] command-output"><span class="text-[#565f89]">‚îî‚îÄ‚ñ∂</span> Command not found: ${command}</div>`);
			}
		}

		private handleBackspace(): void {
			// Handled natively by input field
		}

		private handleArrowUp(): void {
			if (this.historyIndex > 0) {
				this.historyIndex--;
				this.currentInput = this.commandHistory[this.historyIndex];
				this.inputField.value = this.currentInput;
				this.updateInputLine();
				// Move cursor to end
				setTimeout(() => {
					this.inputField.selectionStart = this.inputField.selectionEnd = this.currentInput.length;
				}, 0);
			}
		}

		private handleArrowDown(): void {
			if (this.historyIndex < this.commandHistory.length - 1) {
				this.historyIndex++;
				this.currentInput = this.commandHistory[this.historyIndex];
			} else {
				this.historyIndex = this.commandHistory.length;
				this.currentInput = '';
			}
			this.inputField.value = this.currentInput;
			this.updateInputLine();
		}

		private handleInput(key: string): void {
			// Handled by input event listener
		}

		private updateInputLine(): void {
			const commandText = this.inputLine.querySelector('.command-text');
			if (commandText) {
				commandText.textContent = this.currentInput;
			}
		}

		private focusInput(): void {
			this.inputField.focus();
		}

		private renderOutputHTML(outputDiv: HTMLElement, html: string): void {
			outputDiv.innerHTML = html;
			this.applySyntaxHighlight(outputDiv);
			this.animateOutput(outputDiv);
		}

		private applySyntaxHighlight(root: HTMLElement): void {
			const walker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, null);
			const nodes: Text[] = [];
			while (walker.nextNode()) {
				nodes.push(walker.currentNode as Text);
			}
			nodes.forEach((node) => this.highlightTextNode(node));
		}

		private highlightTextNode(node: Text): void {
			const text = node.textContent ?? '';
			if (!text.trim()) return;

			let html = this.escapeHTML(text);
			let replaced = false;

			this.highlightPatterns.forEach((pattern) => {
				pattern.regex.lastIndex = 0;
				if (pattern.regex.test(html)) {
					html = html.replace(pattern.regex, `<span class="${pattern.className}">$1</span>`);
					replaced = true;
				}
			});

			if (!replaced) return;

			const template = document.createElement('template');
			template.innerHTML = html;
			node.replaceWith(template.content.cloneNode(true));
		}

		private escapeHTML(text: string): string {
			const map: Record<string, string> = {
				'&': '&amp;',
				'<': '&lt;',
				'>': '&gt;',
				'"': '&quot;',
				"'": '&#39;',
			};
			return text.replace(/[&<>"']/g, (char) => map[char]);
		}

		private animateOutput(root: HTMLElement): void {
			const elements = root.children.length ? Array.from(root.children) : [root];
			elements.forEach((el, index) => {
				(el as HTMLElement).classList.add('typing-line');
				(el as HTMLElement).style.animationDelay = `${index * 60}ms`;
			});
		}
	}

	// Initialize terminal when the page loads
	window.addEventListener('load', () => {
		requestAnimationFrame(() => {
			body.classList.add('booted');
			setTimeout(() => body.classList.remove('booting'), 900);
		});
		new Terminal();
	});

	// Add time update functionality
	function updateTime() {
		const now = new Date();
		const timeString = now.toLocaleTimeString();
		
		const timeDiv = document.getElementById('current-time');
		if (timeDiv) {
			timeDiv.textContent = timeString;
		}
		
		const headerTime = document.getElementById('header-time');
		if (headerTime) {
			headerTime.textContent = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
		}
	}

	setInterval(updateTime, 1000);
	updateTime();
</script>

<style>
	.terminal-container {
		@apply bg-[#1a1b26];
		font-family: 'JetBrains Mono', monospace;
		height: 90vh;
		/* Mobile height adjustment */
		@media (max-width: 640px) {
			height: 85vh;
		}
		box-shadow: 0 0 20px rgba(0, 0, 0, 0.4),
					0 0 60px rgba(122, 162, 247, 0.1);
	}
	
	body.booting .terminal-container {
		opacity: 0;
		transform: translateY(16px) scale(0.98);
	}

	body.booted .terminal-container {
		animation: boot-up 0.8s cubic-bezier(0.22, 1, 0.36, 1) forwards;
	}

	body.no-js .terminal-container {
		opacity: 1 !important;
		transform: none !important;
		animation: none !important;
	}

	@keyframes boot-up {
		0% {
			opacity: 0;
			transform: translateY(24px) scale(0.95);
			filter: blur(4px);
		}
		100% {
			opacity: 1;
			transform: translateY(0) scale(1);
			filter: blur(0);
		}
	}

	.terminal-title-bar {
		@apply flex items-center bg-[#1a1b26] border-b border-[#7aa2f7]/20 p-2 sm:p-1;
		background: #1a1b26;
	}

	.terminal-content-area {
		@apply p-2 sm:p-4 overflow-auto space-y-2;
		/* Dynamic height calculation */
		height: 100%;
		background: #1a1b26;
		font-family: 'JetBrains Mono', monospace;
	}

	.command-block {
		@apply mb-2;
	}

	.command-prompt {
		@apply text-[#7aa2f7] mb-1 flex items-center gap-1.5 flex-wrap text-sm;
		font-family: 'JetBrains Mono', monospace;
		position: relative;
	}

	#input-line .command-prompt input {
		position: absolute;
		inset: 0;
		width: 100%;
		height: 100%;
		outline: none;
	}

	.command-output {
		@apply pl-6 py-2 text-sm opacity-90;
		border-left: 2px solid rgba(86, 95, 137, 0.3);
		margin-left: 0.5rem;
	}

	.cursor {
		@apply ml-[1px] -mr-[1px] opacity-70;
	}

	.cursor::after {
		content: "‚ñã";
		animation: cursor-blink 0.8s step-end infinite;
	}

	.typing-line {
		opacity: 0;
		transform: translateY(6px);
		animation: typingLine 0.35s ease forwards;
	}

	@keyframes typingLine {
		from {
			opacity: 0;
			transform: translateY(8px);
			filter: blur(2px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
			filter: blur(0);
		}
	}

	@keyframes cursor-blink {
		0%, 100% { opacity: 1; }
		50% { opacity: 0; }
	}

	body.terminal-idle .cursor::after {
		color: var(--secondary);
		text-shadow: 0 0 8px rgba(158, 206, 106, 0.8);
		animation: idle-pulse 1.4s ease-in-out infinite;
	}

	@keyframes idle-pulse {
		0%, 100% { opacity: 0.2; }
		50% { opacity: 1; }
	}

	/* Custom Scrollbar - More minimal */
	.terminal-content-area {
		scrollbar-width: thin;
		scrollbar-color: rgba(122, 162, 247, 0.3) transparent;
	}

	.terminal-content-area::-webkit-scrollbar {
		width: 2px;
	}

	.terminal-content-area::-webkit-scrollbar-thumb {
		background-color: rgba(122, 162, 247, 0.3);
	}

	.command-list {
		@apply text-sm p-4 rounded;
		background: rgba(26, 27, 38, 0.6);
		border: 1px solid rgba(86, 95, 137, 0.2);
	}

	.command-list p {
		@apply text-[#7aa2f7] mb-2;
	}

	.command-list ul li {
		@apply flex items-center gap-2;
	}

	.command-list ul li span {
		@apply text-[#9ece6a] font-mono;
	}

	/* Update help command styling */
	#help .command-list ul li::before {
		content: "‚îî‚îÄ‚ñ∂";
		@apply text-[#565f89] mr-2;
	}

	.terminal-footer {
		@apply text-center opacity-50 hover:opacity-80 transition-opacity;
		font-family: 'JetBrains Mono', monospace;
	}

	/* Window Controls */
	.terminal-button {
		@apply w-3 h-3 rounded-full border border-black/10 relative flex items-center justify-center;
	}

	.terminal-button::before {
		content: '';
		@apply opacity-0 transition-opacity duration-200 text-[8px] font-bold text-black/50;
	}

	.terminal-buttons:hover .terminal-button::before {
		@apply opacity-100;
	}

	/* Mobile-specific styles */
	@media (max-width: 640px) {
		.mobile-section {
			@apply bg-[#1a1b26] rounded-lg p-4;
			border: 1px solid rgba(122, 162, 247, 0.1);
		}

		.mobile-section h2 {
			@apply mb-4;
		}

		/* Adjust command output for mobile */
		.command-output {
			@apply pl-4;
			border-left: 1px solid rgba(86, 95, 137, 0.3);
		}

		/* Make links more touchable */
		a {
			@apply py-2;
		}

		/* Improve mobile scrolling */
		body {
			@apply overflow-hidden;
		}

		.block.sm\:hidden {
			height: 100vh;
			overflow-y: auto;
			-webkit-overflow-scrolling: touch;
		}

		/* Section spacing */
		.space-y-8 > * {
			@apply mb-8;
		}

		/* Mobile footer */
		.fixed.bottom-0 {
			@apply text-center shadow-lg z-50;
			background: rgba(26, 27, 38, 0.95);
			backdrop-filter: blur(8px);
			position: fixed;
			bottom: 0;
			left: 0;
			right: 0;
			padding: 0.75rem;
		}

		/* Ensure content doesn't hide behind footer */
		.p-4.pb-20 {
			padding-bottom: 5rem;
		}
	}

	/* Remove fancy background effects */
	.terminal-container {
		background-image: none !important;
	}

	/* Adjust text colors for more terminal-like appearance */
	.text-[#c0caf5] {
		@apply opacity-90;
	}

	.welcome-text {
		@apply opacity-80;
	}

	/* Make the ASCII art more terminal-like */
	.ascii-art {
		@apply opacity-70;
	}

	.command-help-list {
		@apply space-y-2 ml-4;
	}

	.command-help-list li {
		@apply flex items-start gap-4;
	}

	.command-name {
		@apply text-[#9ece6a] w-24 font-mono;
	}

	.command-desc {
		@apply text-[#c0caf5] opacity-80;
	}

	/* Matrix animation */
	.matrix-animation pre {
		animation: matrix 2s infinite;
		font-family: 'JetBrains Mono', monospace;
	}

	@keyframes matrix {
		0%, 100% { opacity: 1; }
		50% { opacity: 0.7; }
	}

	/* Ping animation */
	.ping-animation .ping-line {
		animation: fade-in 0.3s ease-out forwards;
		opacity: 0;
	}

	.ping-animation .ping-line:nth-child(1) { animation-delay: 0s; }
	.ping-animation .ping-line:nth-child(2) { animation-delay: 0.5s; }
	.ping-animation .ping-line:nth-child(3) { animation-delay: 1s; }
	.ping-animation .ping-line:nth-child(4) { animation-delay: 1.5s; }

	@keyframes fade-in {
		from {
			opacity: 0;
			transform: translateY(-4px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	/* Copy/Paste Styles */
	.copy-button {
		@apply fixed bg-[#1a1b26] text-[#7aa2f7] px-2 py-1 rounded cursor-pointer z-50 
			   border border-[#7aa2f7]/20 hover:bg-[#7aa2f7]/10 transition-colors;
		display: none;
	}

	.copy-feedback {
		@apply fixed top-4 right-4 bg-[#9ece6a] text-[#1a1b26] px-4 py-2 rounded shadow-lg z-50;
		animation: fadeInOut 1.5s ease-in-out forwards;
	}

	@keyframes fadeInOut {
		0% { opacity: 0; transform: translateY(-20px); }
		10% { opacity: 1; transform: translateY(0); }
		90% { opacity: 1; transform: translateY(0); }
		100% { opacity: 0; transform: translateY(-20px); }
	}

	/* Selection style */
	::selection {
		@apply bg-[#7aa2f7]/30 text-[#c0caf5];
	}

	#terminal::before,
	#terminal::after {
		content: '';
		position: absolute;
		left: 50%;
		top: 1.5rem;
		transform: translate(-50%, 0);
		padding: 0.5rem 1rem;
		border-radius: 999px;
		font-size: 0.65rem;
		letter-spacing: 0.1em;
		text-transform: uppercase;
		background: rgba(0, 0, 0, 0.45);
		color: var(--primary);
		box-shadow: 0 0 15px rgba(122, 162, 247, 0.25);
		pointer-events: none;
		opacity: 0;
		transition: opacity 0.4s ease, transform 0.4s ease;
	}

	#terminal::before {
		content: 'Booting portfolio OS...';
	}

	body.booting #terminal::before {
		opacity: 1;
		transform: translate(-50%, -10px);
	}

	body.booted #terminal::before {
		opacity: 0;
		transform: translate(-50%, -20px);
	}

	#terminal::after {
		content: 'Idle ‚Äî tap to resume';
		top: auto;
		bottom: 1.5rem;
		background: rgba(17, 24, 39, 0.8);
		border: 1px solid rgba(154, 206, 106, 0.3);
		color: var(--secondary);
		box-shadow: 0 0 25px rgba(154, 206, 106, 0.25);
	}

	body.terminal-idle #terminal::after {
		opacity: 0.35;
		transform: translate(-50%, 0);
	}

	body.booting #terminal {
		pointer-events: none;
	}

	body.no-js #terminal::before,
	body.no-js #terminal::after {
		display: none;
	}

	.syntax-error {
		color: #f7768e;
		font-weight: 600;
	}

	.syntax-success {
		color: #9ece6a;
		font-weight: 600;
	}

	.syntax-warning {
		color: #e0af68;
		font-weight: 600;
	}

	.syntax-flag {
		color: #bb9af7;
	}

	.syntax-path {
		color: #e0af68;
	}

	.syntax-command {
		color: #7aa2f7;
		font-weight: 600;
	}

	.syntax-link {
		color: #7dcfff;
		text-decoration: underline;
		text-decoration-color: rgba(125, 207, 255, 0.6);
	}

	@media (prefers-reduced-motion: reduce) {
		body.booted .terminal-container {
			animation: none !important;
		}

		.cursor::after,
		body.terminal-idle .cursor::after {
			animation: none !important;
			opacity: 1;
		}

		#terminal::before,
		#terminal::after {
			transition: none;
		}
	}

	/* Command Auto-completion Styles */
	.suggestions-container {
		@apply absolute bg-[#1a1b26] border border-[#7aa2f7]/20 rounded-md 
			   shadow-lg z-50 max-h-48 overflow-y-auto min-w-[150px];
	}

	.suggestions-container.hidden {
		display: none;
	}

	.suggestion-item {
		@apply px-4 py-2 text-[#c0caf5] hover:bg-[#7aa2f7]/10 cursor-pointer
			   transition-colors text-sm font-mono;
	}

	.suggestion-item .matched-text {
		@apply text-[#c0caf5];
	}

	.suggestion-item .remaining-text {
		@apply text-[#c0caf5] opacity-50;
	}

	.suggestion-item:hover .remaining-text {
		@apply opacity-70;
	}

	.suggestion-item:not(:last-child) {
		@apply border-b border-[#7aa2f7]/10;
	}

	/* Ensure suggestions container scrollbar matches terminal style */
	.suggestions-container::-webkit-scrollbar {
		width: 8px;
	}

	.suggestions-container::-webkit-scrollbar-track {
		@apply bg-[#1a1b26];
	}

	.suggestions-container::-webkit-scrollbar-thumb {
		@apply bg-[#7aa2f7]/20 rounded-full hover:bg-[#7aa2f7]/30 transition-colors;
	}
</style>
